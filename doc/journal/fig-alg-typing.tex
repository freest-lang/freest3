\begin{figure}[h!]
  The \emph{synthesise} relation\hfill\fbox{$\algtypeout e T \varEnv$}
  \begin{gather*}
    % Variables
    \frac{
      x\colon \tForall \Empty T \in \varEnv
      \quad
      \isLin{\tForall \Empty T}
    }{
      \algtypeout x T {\varEnv\setminus x}
    }
    \quad
    \frac{
      x\colon \tForall \Empty T \in \varEnv
      \quad
      \isUn{\tForall \Empty T}
    }{
      \algtypeout x T \varEnv
    }
    \\
    % Type application
    \frac{
      x\colon\tForall{\vec y\colon\vec\kind}{T} \in \varEnv
      \quad
      \isLin{\tForall{\vec y\colon\vec\kind}{T}}
      \quad
      \algkindin{\vec U}{\vec\kind}
    }{
      \algtypeout{x[U]}{\subs{\vec U}{\vec y}T}{\varEnv\setminus x}
    }
    \\
    \frac{
      x\colon\tForall{\vec y\colon\vec\kind}{T} \in \varEnv
      \quad
      \isUn{\tForall{\vec y\colon\vec\kind}{T}}
      \quad
      \algkindin{\vec U}{\vec\kind}
    }{
      \algtypeout{x[U]}{\subs{\vec U}{\vec y}T}{\varEnv}
    }
    % \frac{
    %   \isUn T
    %   \quad
    %   \algkindout U {\kind'}
    %   \quad
    %   \isSubkind{\kind'}{\kind}
    % }{
    %   \algtypeout[\kindEnv;\varEnv,x\colon\tForall{y\colon\kind}{T}]{x[U]}{\subs
    %     U x T}{\varEnv,x\colon\tForall{y\colon\kind}{T}}
    %   }
    \\
    % Abstraction
    \frac{
      \algkindout{T_1} \kind
      \quad
      \algtypeout[\kindEnv;\varEnv_1,x\colon T_1]{e}{T_2}{\varEnv_2}
      \quad
      q=\unk \Rightarrow \varEnv_1 = \varEnv_2 \div (x\colon T)
    }{
      \algtypeout[\kindEnv;\varEnv_1]{(q\lambda x:T_1.e)}{(T_1 \rightarrow_q T_2)}{\varEnv_2 \div (x\colon T)}
    }
    \\
    % Application
    \frac{
      \algtypeout[\kindEnv;\varEnv_1]{e_1}{T}{\varEnv_2}
      \quad
      T \Extract{} U_1\rightarrow_m U_2
      \quad
      \algtypein[\kindEnv;\varEnv_2]{e_2}{U_1}{\varEnv_3}
    }{
      \algtypeout[\kindEnv;\varEnv_1]{e_1e_2}{U_2}{\varEnv_3}
    }
    \\
    % Let, a derived constructor
    \frac{
      \algtypeout[\kindEnv;\varEnv_1]{e_1}{T_1}{\varEnv_2}
      \quad
      \algtypeout[\kindEnv;\varEnv_2,x\colon T_1]{e_2}{T_2}{\Gamma_3}
    }{
      \algtypeout[\kindEnv;\varEnv_1]{\unlete{x}{e_1}{e_2}}{T_2}{\varEnv_3 \div (x\colon T_1)}
    }
    \\
    % Conditional
    \frac{
      \algtypein[\kindEnv;\varEnv_1]{e_1}{\boole}{\varEnv_2}
      \quad
      \algtypeout[\kindEnv;\varEnv_2]{e_2}{T}{\varEnv_3}
      \quad
      \algtypein[\kindEnv;\varEnv_2]{e_3}{T}{\varEnv_4}
      \quad
      \ctxequiv{\varEnv_3}{\varEnv_4}
    }{
      \algtypeout[\kindEnv;\varEnv_1]{\conditionale{e_1}{e_2}{e_3}}{T}{\varEnv_3}
    }
    \\
    % Pair constructor
    \frac{
      \algtypeout[\kindEnv ; \varEnv_1]{e_1}{T_1}{\varEnv_2}
      \quad
      \algtypeout[\kindEnv ; \varEnv_2]{e_2}{T_2}{\varEnv_3}
      \quad
      \isType{T_1,T_2}{m}
    }{
      \algtypeout[\kindEnv ; \varEnv_1]{m(e_1, e_2)}{(T_1,T_2)}{\varEnv_3}
    }
    \\
    % Pair destructor
    \frac{
      \algtypeout[\kindEnv ; \varEnv_1]{e_1}{T}{\varEnv_2}
      \quad
      T \Extract{} q(U_1, U_2)
      \quad
      \algtypeout[\kindEnv; \varEnv_2, x\colon U_1, y\colon U_2]{e_2}{U}{\varEnv_3}
    }{
      \algtypeout[\kindEnv;
      \varEnv_1]{\binlete{x}{y}{e_1}{e_2}}{U}{\varEnv_3} \div (x\colon U_1, y\colon U_2)
    }
    \\
    % Channel creation
    \frac{
      \kindEnv \Alg T \leftarrow \kinds^{\Lin}
    }{
      \kindEnv;\varEnv \Alg \newe{T} \rightarrow (T, \dual{T}); \varEnv
    }
    \quad
    % Send
    \frac{
      \algtypeout[\kindEnv;\varEnv_1]{e}{T}{\varEnv_2}
      \quad
      T\Extract{} !U_1;U_2
    }{
      \algtypeout[\kindEnv;\varEnv_1]{\sendce e}{(U_1\multimap U_2)}{\varEnv_2}
    }
    \\
    % Receive
    \frac{
      \algtypeout[\kindEnv;\varEnv_1]{e_1}{T}{\varEnv_2}
      \quad T
      \Extract{} ?U_1;U_2
    }{
      \algtypeout[\kindEnv;\varEnv_1]{\recve e}{(U_1,U_2)}{\varEnv_2}
    }
    \quad
    % Select
    \frac{
      \algtypeout[\kindEnv;\varEnv_1]{e}{T}{\varEnv_2}
      \quad
      T \Extract{}\oplus\{C_i\colon U_i\}_{i\in I}
      \quad
      j \in I
    }{
      \algtypeout[\kindEnv;\varEnv_1]{\selecte{C_j}{e}}{U_j}{\varEnv_2}
    }
    \\
    % Match 
    \frac{
      \algtypeout[\kindEnv;\varEnv_1]{e}{T}{\varEnv_2}
      \quad
      T \Extract{} \&\{C_i\colon T_i\}
      \quad 
      \algtypeout[\kindEnv;\varEnv_2, x_i\colon T_i]{e_i}{U_i}{\Sigma_i}
      \quad 
      \typeequiv{U_1}{U_i}
      \quad
      \ctxequiv{\Sigma_1}{\Sigma_i} 
    }{
      \algtypeout[\kindEnv;\varEnv_1]{\matche{e}{\{C_i\,x_i \rightarrow e_i\}}}{U_1}{\Sigma_1}
    }
  \\
  \frac{
    \algtypeout[\kindEnv;\varEnv_1]{e}{T}{\varEnv_2}
    \quad
    T \Extract{}[C_i\colon\vec T_i]
    \quad
    \algtypeout[\kindEnv;\varEnv_2, \vec x_i\colon\vec T_i]{e_i}{U_i}{\Sigma_i}
    \quad
    \typeequiv{U_1}{U_i}    
    \quad
    \ctxequiv{\Sigma_1}{\Sigma_i} 
  }{
    \algtypeout[\kindEnv;\varEnv_1]{\casee{e}{\{C_i\,\vec x\rightarrow e_i\}}}{U}{\Sigma_1}
  }
  \\ % Fork
  \frac{
    \algtypeout[\kindEnv;\varEnv_1]{e}{T}{\varEnv_2}
    \quad
    \isUn T
  }{
    \algtypeout[\kindEnv;\varEnv_1]{\forke{e}}{\unite}{\varEnv_2}
  }
  \end{gather*}
  % 
  % 
  The \emph{check against} relation\hfill\fbox{$\algtypein e T \varEnv$}
  \begin{gather*}
    % Let, a derived constructor
    \frac{
      \algtypeout[\kindEnv;\varEnv_1]{e_1}{T_1}{\varEnv_2}
      \quad
      \algtypein[\kindEnv;\varEnv_2,x\colon T_1]{e_2}{T_2}{\Gamma_3}
    }{
      \algtypein[\kindEnv;\varEnv_1]{\unlete{x}{e_1}{e_2}}{T_2}{\varEnv_3}
    }
    \\
    % Pair destructor
    \frac{
      \algtypeout[\kindEnv ; \varEnv_1]{e_1}{T}{\varEnv_2}
      \quad
      \algtypein[\kindEnv; \varEnv_2, x\colon U_1, y\colon U_2]{e_2}{U}{\varEnv_3}
    }{
      \algtypein[\kindEnv;
      \varEnv_1]{\binlete{x}{y}{e_1}{e_2}}{U}{\varEnv_3} \div (x\colon U_1, y\colon U_2)
    }
    \\
    % Conditional
    \frac{
      \algtypein[\kindEnv;\varEnv_1]{e_1}{\boole}{\varEnv_2}
      \quad
      \algtypein[\kindEnv;\varEnv_2]{e_2}{T}{\varEnv_3}
      \quad
      \algtypein[\kindEnv;\varEnv_2]{e_3}{T}{\varEnv_4}
      \quad
      \ctxequiv{\varEnv_3}{\varEnv_4}
    }{
      \algtypein[\kindEnv;\varEnv_1]{\conditionale{e_1}{e_2}{e_3}}{T}{\varEnv_3}
    }
    \\
        \frac{
      \algtypeout e U \varEnv
      \quad
      \typeequiv T U
    }{
      \algtypein e T \varEnv
    }
  \end{gather*}
  \caption{Algorithmic type checking}
  \label{fig:alg-typing}
\end{figure}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
