\lstset{language=freest, numbers=none, escapeinside=||}

\begin{frame}[fragile]{A linguagem \mixedchoice}
  \begin{itemize}
  \item Funcional;\pause
  \item Sintaxe semelhante à do Haskell;\pause
  \item Acrescida de primitivas para criação de canais e transmissão de mensagens;\pause
  \item Construída sobre a linguagem \freest;\pause
  \item Caracterizada pela primitiva \lstinline|choice|;\pause
  \end{itemize}

  \begin{tcolorbox}
Permite enumerar as operações de trocas de mensagens que poderão ser escolhidas.
\end{tcolorbox}
%TODO Explain
\end{frame}

\begin{frame}[fragile]{A linguagem \mixedchoice  \hfill \color{mLightBrown}Tipos}
  \input{fig-types}
%  \pause
  %\lstinline|type CanalInt = ?EOS + !Int;CanalInt| 
%  Nesta sintaxe, o tipo do canal \lstinline|CanalInt|:
%   \begin{lstlisting}
% type CanalInt = ?EOS + !Int;CanalInt
% \end{lstlisting}
% \pause
% escreve-se:
% \begin{lstlisting}
% rec x . ?EOS + !Int;x|
% \end{lstlisting}
\end{frame}

\begin{frame}[fragile]{Equivalência de tipos}
  \begin{itemize}
  \item Os tipos de sessão da linguagem \mixedchoice{} são independentes do contexto.
    \pause
  \item A noção de equivalência mais apropriada é a bisimulação.
    \pause
  \item O algoritmo de equivalência de tipos para a linguagem \freest{} (sem escolhas mistas) foi facilmente adaptado.
    % \begin{itemize}
    % \item Traduz os tipos em gramáticas;
    %   \pause
    % \item Simplifica as gramáticas (limpa as produções \textit{unnormed});
    %   \pause
    % \item Decide a existência de uma bisimulação através de uma árvore de expansão;
    %   \pause
    % \item Alterna entre expansões ou simplificações sobre os símbolos da gramática
    %   até encontrar um ramo que seja bem sucedido, ou concluir que todos os ramos são mal sucedidos.
    % \end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{\textit{Runtime}}
  A primitiva \lstinline|choice|:
  \begin{itemize}
  \item \textit{Thread} extra para encontrar duas escolhas compatíveis.
  \item Comunica com os dois processos através de dois canais síncronos.
  \item Troca de mensagens através de um terceiro canal.
  \end{itemize}
\end{frame}

\begin{frame}[fragile]{\textit{Runtime}}
  \textbf{Produtor:}\\
  \begin{lstlisting}
  choice {(c, EOS) = receive -> (),
                 c = send c n -> produtor c (n+1)}
\end{lstlisting}

\textbf{Consumidor (ramo else):}\\
$\quad$\lstinline|choice {(c, m) = receive c -> consumidor c (s+m)  (n+1)  k}|\\
\vspace{3mm}
\textbf{Mensagens trocadas:}\\
$\quad$produtor $\rightarrow$ broker: \lstinline|?EOS + !Int|\\
$\quad$consumidor $\rightarrow$ broker: \lstinline|?Int|\\
$\quad$broker $\rightarrow$ produtor: \lstinline|!Int|\\
$\quad$broker $\rightarrow$ consumidor: \lstinline|?Int|\\
$\quad$produtor $\rightarrow$ consumidor: 999

\end{frame}

% \begin{frame}[fragile]{Equivalência de tipos}
%   \begin{itemize}
%   \item Os tipos de sessão com escolhas mistas, presentes em \mixedchoice,
%     tem uma expressividade idêntica à das gramáticas simples;
%     \pause
%     \vspace{1cm}
%   \item Assim, é possível utilizar o algoritmo desenvolvido para \freest$\,$
%     para determinar se dois tipos são equivalentes.
% \end{itemize}
% \end{frame}

% \begin{frame}[fragile]{Implementação}
%   \begin{itemize}
%   \item Segue as mesmas diretrizes do compilador da linguagem \freest
%     \pause
%     \vspace{1cm}
%   \item Sistema de verificação de géneros (\textit{kinding})
%     \pause
%     \vspace{1cm}   
%   \item Sistema de verificação de tipos
%   \end{itemize}
% \end{frame}

% \begin{frame}[fragile]{Implementação}  
%   O ambiente de execução (\textit{runtime system}) é bastante compacto.
%   É composto pelas primitivas de:
  
%   \begin{itemize}
%   \item Criação de novas \textit{threads} (\lstinline|fork|)\pause
%   \item Manipulação de canais (\lstinline|send|, \lstinline|receive|, \lstinline|choice|)
%   \end{itemize}
% \pause
% \vspace{5mm}
% O compilador gera código Haskell que posteriormente será compilado através do GHC, o compilador convencional do Haskell. 
% \end{frame}

% \begin{frame}[fragile]{Conclusão}
%   \begin{itemize}
%   \item Propomos uma linguagem de programação funcional, semelhante à linguagem \freest, com tipos de sessão independentes do contexto mais expressivos que os anteriores.
%     \pause
%     \vspace{1cm}
%   \item O algoritmo de equivalência de tipos, existente no compilador de \freest{} pode ser utilizado na linguagem \mixedchoice.
%     \pause
%     \vspace{1cm}    
%   \item Estamos neste momento a modificar o compilador de
%   \freest$\,$ de modo a acomodar escolhas múltiplas.  
%   \end{itemize}
% \end{frame}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
